# 字节对齐

- 学习[C语言字节对齐问题详解](http://www.cnblogs.com/clover-toeic/p/3853132.html)笔记

## 1 什么是字节对齐

现代计算机中，内存空间按照字节划分，理论上可以从任何起始地址访问任意类型的变量。但实际中在访问特定类型变量时经常在特定的内存地址访问，这就需要各种类型数据按照一定的规则在空间上排列，而不是顺序一个接一个地存放，这就是对齐。

### 对齐的原因和作用

- 某些平台对特定类型的数据只能从特定地址开始存取，而不允许其在内存中任意存放。
- 如果不按照平台要求对数据存放进行对齐，会带来存取效率上的损失。
- 合理利用字节对齐还可以有效地节省存储空间。

## 2 对齐的分类和准则

- 主要基于Intel X86架构介绍结构体对齐和栈内存对齐，位域本质上为结构体类型。
- 对于Intel X86平台，每次分配内存应该是从4的整数倍地址开始分配，无论是对结构体变量还是简单类型的变量。

### 2.1 结构体对齐

在对结构体分配内存的时候，需要满足某些准则，而不会完全按照结构体成员的大小以此累加的分配内存。

结构体字节对齐的细节和具体编译器实现相关，但一般而言满足三个准则：

- 结构体变量的首地址能够被其最宽基本类型成员的大小所整除；
- 结构体每个成员相对结构体首地址的偏移量(offset)都是成员大小的整数倍，如有需要编译器会在成员之间加上填充字节(internal adding)；
- 结构体的总大小为结构体最宽基本类型成员大小的整数倍，如有需要编译器会在最末一个成员之后加上填充字节{trailing padding}。

### 2.2 栈内存对齐

在VC/C++中，栈的对齐方式不受结构体成员对齐选项的影响。总是保持对齐且对齐在4字节边界上。

### 2.3 位域对齐

- [ ] todo