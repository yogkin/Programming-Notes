# 内存四区

---   
## 1 C语言内存划分

C语言程序中，代码是放在内存中执行的，程序所占用的内存分为四个区域：

- 栈区
- 堆区
- 静态区
- 代码区

每个程序都有唯一一个内存四区，作为程序员应该掌握各个区域的特性，例如存储哪种类型的数据，由谁去申请开辟，又由谁去管理释放等等。


---   
## 2 内存四区说明

- 栈区（stack）：由编译器自动分配释放 ，存放函数的参数值，局部变量的值等。其操作方式类似于数据结构中的栈。
- 堆区（heap）： 一般由程序员分配释放， 若程序员不释放，程序结束时可能由OS回收。注意它与数据结构中的堆是两回事，分配方式类似于链表。
- 数据区：主要包括静态全局区和常量区，如果要站在汇编角度细分的话还可以分为很多小的区。
    - 全局区（静态区）（static）：全局变量和静态变量的存储是放在一块的，初始化的全局变量和静态变量在一块区域，未初始化的全局变量和未初始化的静态变量在相邻的另一块区域。 程序结束后有系统释放
    - 常量区 ：常量字符串就是放在这里的。 程序结束后由系统释放
- 代码区：存放函数体的二进制代码。


---   
## 3 堆栈的生长方向

1. 堆栈的生长方向和存放数据增长方向不一样
2. 每个方法的栈在编译期间即可确定，栈的生长方向是由高位内存到低位内存进行分配的。
3. 堆内存是程序运行时动态分配的，生长方向与栈去正好相反


---   
## 4 特性

### 申请方式 

- stack: 由系统自动分配。 例如，声明在函数中一个局部变量` int b;` 系统自动在栈中为b开辟空间，栈的可用比较小，所以在程序中自动变量数组（函数内部）不能很大。
- heap: 需要程序员自己申请，并指明大小，在c中malloc函数 

### 申请后系统的响应 

- 栈：只要栈的剩余空间大于所申请空间，系统将为程序提供内存，否则将报异常提示栈溢出。 
- 堆：首先应该知道操作系统有一个记录空闲内存地址的链表，当系统收到程序的申请时，会遍历该链表，寻找第一个空间大于所申请空间的堆结点，然后将该结点从空闲结点链表中删除，并将该结点的空间分配给程序，另外，对于大多数系统，会在这块内存空间中的首地址处记录本次分配的大小，这样，代码中的delete语句才能正确的释放本内存空间。另外，由于找到的堆结点的大小不一定正好等于申请的大小，系统会自动的将多余的那部分重新放入空闲链表中。


---
## 引用

- [C语言中一些关于内存四区的归纳](http://www.jianshu.com/p/98cb5f584a31)
- [C语言的变量的内存分配](http://blog.csdn.net/chenyiming_1990/article/details/9476181)